### Установка и настройка EMQX (Erlang MQTT Broker)

**EMQX** — это высокопроизводительный MQTT-брокер, который поддерживает протокол MQTT и имеет веб-интерфейс для управления. Он прост в установке и настройке, а также позволяет вам управлять подключениями и доступом к вашему MQTT-брокеру через удобный веб-интерфейс.

---

### Шаг 1: Установка EMQX с использованием Docker

1. **Загрузите и запустите контейнер EMQX**:

   Чтобы установить EMQX, используйте Docker. Откройте терминал и выполните следующую команду:

   ```bash
   docker run -d \
     --name emqx \
     -p 1883:1883 \
     -p 18083:18083 \
     emqx/emqx
   ```

   Здесь:
   - **1883** — порт для стандартного MQTT-протокола.
   - **18083** — порт для веб-интерфейса EMQX.

2. **Проверка работы контейнера**:

   Для проверки, что контейнер работает, выполните команду:

   ```bash
   docker ps
   ```

   Вы должны увидеть контейнер с именем `emqx` в списке запущенных контейнеров.

---

### Шаг 2: Доступ к веб-интерфейсу EMQX

1. **Откройте веб-интерфейс EMQX**:

   В браузере перейдите по адресу:

   ```
   http://<IP_вашего_сервера>:18083
   ```

   Где **`<IP_вашего_сервера>`** — это IP-адрес вашего сервера или **localhost**, если вы используете локальный сервер.

2. **Логин в админку**:

   По умолчанию используйте следующие данные для входа:
   - **Логин**: `admin`
   - **Пароль**: `public`

---

### Шаг 3: Настройка аутентификации (логин и пароль)

1. **Включение аутентификации**:

   Для включения аутентификации и использования логинов и паролей, откройте веб-интерфейс и перейдите в раздел **Authentication & Authorization** или аналогичный.

   Убедитесь, что параметр **Enable Authentication** установлен в **true**. Это позволит системе запрашивать логины и пароли для подключения к серверу.

2. **Создание пользователя**:

   Перейдите в раздел **Users** (Пользователи) и добавьте нового пользователя:
   - Введите **логин** и **пароль** для пользователя.
   - Сохраните изменения.

3. **Настройка прав доступа (ACL)**:

   Если нужно, вы можете настроить права доступа для пользователей через раздел **ACL** (Access Control List):
   - Задайте разрешения для публикации и подписки на топики.
   - Пример ACL, разрешающий пользователю публиковать и подписываться на топик:
   
     ```json
     {
       "username": "user1",
       "password": "password1",
       "topic": "test/topic",
       "access": ["publish", "subscribe"]
     }
     ```

4. **Сохранение настроек и перезапуск**:

   После настройки аутентификации и прав доступа сохраните изменения и перезапустите сервер, если это необходимо.

---

### Шаг 4: Подключение к серверу EMQX

1. **Подключение MQTT-клиента**:

   Теперь, когда сервер настроен, вы можете подключаться к нему с помощью MQTT-клиента. Используйте такие инструменты как **MQTT.fx**, **mosquitto_pub**, или **mosquitto_sub** для тестирования соединений.

2. **Пример подключения с использованием mosquitto_pub и mosquitto_sub**:

   - Подключение клиента для подписки на топик:

     ```bash
     mosquitto_sub -h <IP_вашего_сервера> -t "test/topic" -u "user1" -P "password1"
     ```

   - Отправка сообщения на топик:

     ```bash
     mosquitto_pub -h <IP_вашего_сервера> -t "test/topic" -m "Hello, EMQX!" -u "user1" -P "password1"
     ```

---

### Шаг 5: Дополнительная настройка

1. **Настройка конфигурации через файл**:

   Вы можете настроить дополнительные параметры EMQX, изменяя конфигурационный файл. Для этого подключитесь к контейнеру:

   ```bash
   docker exec -it emqx /bin/sh
   ```

   Файл конфигурации находится в директории `/opt/emqx/etc/emqx.conf`. Вы можете отредактировать его, используя текстовый редактор, например, `vi` или `nano`.

2. **Добавление дополнительного модуля безопасности**:

   EMQX поддерживает различные модули безопасности, такие как:
   - SSL/TLS для защищенных соединений.
   - Ожидаемая аутентификация через LDAP или OAuth.

3. **Мониторинг и статистика**:

   Через веб-интерфейс EMQX можно мониторить активные подключения, статистику по топикам, количеству сообщений и производительности брокера.

---

### Заключение

Теперь ваш EMQX-сервер настроен для работы с MQTT-клиентами через аутентификацию и веб-интерфейс. Вы можете управлять пользователями, правами доступа и мониторить сервер через веб-интерфейс, который предоставляет удобные возможности для администрирования.